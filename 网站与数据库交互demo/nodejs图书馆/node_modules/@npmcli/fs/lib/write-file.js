const fs = require('@npmcli/fs/lib/fs.js')
const getOptions = require('@npmcli/fs/lib/common/get-options.js')
const owner = require('@npmcli/fs/lib/common/owner.js')

const writeFile = async (file, data, opts) => {
  const options = getOptions(opts, {
    copy: ['encoding', 'mode', 'flag', 'signal', 'owner'],
    wrap: 'encoding',
  })
  const { uid, gid } = await owner.validate(file, options.owner)

  const result = await fs.writeFile(file, data, options)

  await owner.update(file, uid, gid)

  return result
}

module.exports = writeFile
